#include <SiroSpectrum/core.h>
#include <SiroSpectrum/game.h>
#include <stdio.h>

//typedef struct Tile {
//	unsigned char canvas[8 * 8];
//	unsigned char colour;
//}Tile;

unsigned char stefanvas[8 * 16] = {
	0,0,0,1,1,1,0,0,
	0,0,1,1,1,1,1,0,
	0,1,1,1,1,1,0,0,
	0,1,1,1,0,1,0,0,
	0,1,1,1,1,1,1,0,
	0,0,1,1,1,1,0,0,
	0,0,0,1,1,0,0,0,
	0,0,1,0,0,1,0,0,
	0,1,1,1,1,1,0,0,
	0,1,0,1,1,1,0,0,
	0,0,0,1,1,1,0,0,
	0,1,0,0,0,0,1,0,
	0,0,1,1,1,1,0,0,
	0,0,1,1,0,1,0,0,
	0,0,1,0,1,1,0,0,
	0,0,1,1,0,1,1,0,
};

unsigned char stefanvas1[8 * 16] = { 
0,0,0,1,1,1,0,0,
0,0,1,1,1,1,1,0,
0,1,1,1,1,1,1,0,
0,1,1,1,0,1,0,0,
0,1,1,1,1,1,1,0,
0,0,1,1,1,1,0,0,
0,0,0,1,1,0,0,0,
0,0,1,0,0,1,0,0,
0,1,1,1,1,1,1,0,
1,0,0,1,1,1,1,0,
0,0,1,1,1,1,0,1,
1,0,0,0,0,0,0,0,
0,0,1,1,1,1,0,0,
0,1,1,1,0,1,1,0,
1,1,0,0,0,1,1,1,
0,1,1,0,0,0,1,0,
};

unsigned char stefanvas2[8 * 16] = {
0,0,0,1,1,1,0,0,
0,0,1,1,1,1,1,0,
0,1,1,1,1,1,1,0,
0,1,1,1,0,1,0,0,
0,1,1,1,1,1,1,0,
0,0,1,1,1,1,0,0,
0,0,0,1,1,0,0,0,
0,0,1,0,0,1,0,0,
0,1,1,1,1,1,0,0,
0,1,0,1,1,1,0,0,
0,1,0,1,1,1,0,0,
0,0,1,0,0,0,0,0,
0,0,0,1,1,1,0,0,
0,0,1,1,0,1,0,0,
0,0,1,0,1,0,0,0,
0,0,0,1,0,1,0,0, 
};

unsigned char wall[8 * 8] = {
	0,1,0,0,0,0,0,0,
	0,1,0,0,0,0,0,0,
	1,1,1,1,1,1,1,1,
	0,0,0,0,0,1,0,0,
	0,0,0,0,0,1,0,0,
	0,0,0,0,0,1,0,0,
	1,1,1,1,1,1,1,1,
	0,1,0,0,0,0,0,0,
};


unsigned char map[32 * 24] = {
	1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
	1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
	1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
	1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
	1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
	1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
	1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
	1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
	1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
	1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
	1,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
	1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
	1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
	1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
	1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
	1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
	1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
	1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
	1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
	1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
	1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
	1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
	1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,
	1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
};
unsigned char cat[] ={
	1,0,0,0,1,0,0,1,
	1,0,0,0,1,1,1,1,
	1,1,0,0,1,0,1,0,
	0,1,1,1,1,1,1,1,
	0,0,1,1,1,1,1,0,
	0,0,1,0,1,0,1,0,
};
Tile Air = { {
	0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,}, 0b00000000 };

Tile Wall = { {
	0,1,0,0,0,0,0,0,
	0,1,0,0,0,0,0,0,
	1,1,1,1,1,1,1,1,
	0,0,0,0,0,1,0,0,
	0,0,0,0,0,1,0,0,
	0,0,0,0,0,1,0,0,
	1,1,1,1,1,1,1,1,
	0,1,0,0,0,0,0,0,}, 0b00100001 };

Sprite Stefan = {stefanvas, 8, 16};
Sprite Stefan1 = {stefanvas1, 8, 16};
Sprite Stefan2 = {stefanvas2, 8, 16};
Sprite downey = { cat, 8, 6 };
Tile tiles[2];
Sprite stef_walk[3];

unsigned char plr_x = 0;
unsigned char plr_y = 0;
unsigned char dir = 0b0001000;
unsigned char frame = 0;
unsigned char timer = 0;

void setup() {
	plr_x = 100;
	plr_y = 100;
	frame = 0;
	tiles[0] = Air;
	tiles[1] = Wall;
	stef_walk[1] = Stefan;
	stef_walk[0] = Stefan1;
	stef_walk[2] = Stefan2;
	unsigned short sum = 0;
	for (int y = 0; y < 24; y++) {
		for (int x = 0; x < 32; x++) {
			SetTile(tiles[map[sum]], x, y);
			sum++;
		}
	}
}

void loop() {
	RemoveSprite(Stefan, plr_x, plr_y);
	if (GetKey(Right)) {
		//if (plr_x < 240) {
			plr_x += 2;
			dir = 0b00001000;
		//}
	}
	 if (GetKey(Left)) {
		// if (plr_x > 8) {
			 plr_x -= 2;
			 dir = 0b00011000;
		// }
	}
	 if (GetKey(Up)) {
		// if (plr_y > 8) {
			 plr_y -= 2;
		// }
	}
	 if (GetKey(Down)) {
		// if (plr_y < 168) {
			 plr_y += 2;
		// }
	}
	 SetSprite(downey, 128, 100, 7);
	SetSprite(stef_walk[frame], plr_x, plr_y, dir);
	if (timer / 8) {
		frame++;
		if (frame >= 3) {
			frame = 0;
		}
		timer = 0;
	}
	timer++;
}

int main(void) {
	Game* fungame = newGame(setup, loop);

	RunGame(fungame);

	return 0;
}